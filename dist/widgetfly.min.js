!function(root,factory){"use strict";"function"==typeof define&&define.amd?define([],function(){return root.Widgetfly=factory(root)}):root.Widgetfly=factory(root)}(this,function(){"use strict";var Widgetfly=function(global){var Widgetfly;return global.Widgetfly?(Widgetfly=global.Widgetfly,Widgetfly.init()):(Widgetfly={},function(){var cssText='.widgetfly .wf-show,.widgetfly.wf-show{display:block !important}.widgetfly .wf-hide,.widgetfly.wf-hide{display:none !important}.widgetfly .wf-root,.widgetfly.wf-root{position:absolute;left:0px;top:-9999px;width:47px;height:29px;z-index:999999999}.widgetfly .wf-spinner,.widgetfly.wf-spinner{margin:16px auto;width:50px;height:30px;text-align:center;font-size:10px}.widgetfly .wf-spinner>div,.widgetfly.wf-spinner>div{background-color:#666;height:100%;width:6px;display:inline-block;margin:0 3px 0 0;-webkit-animation:wf-stretchdelay 1.2s infinite ease-in-out;animation:wf-stretchdelay 1.2s infinite ease-in-out}.widgetfly .wf-spinner>.rect2,.widgetfly.wf-spinner>.rect2{-webkit-animation-delay:-1.1s;animation-delay:-1.1s}.widgetfly .wf-spinner>.rect3,.widgetfly.wf-spinner>.rect3{-webkit-animation-delay:-1s;animation-delay:-1s}.widgetfly .wf-spinner>.rect4,.widgetfly.wf-spinner>.rect4{-webkit-animation-delay:-0.9s;animation-delay:-0.9s}.widgetfly .wf-spinner>.rect5,.widgetfly.wf-spinner>.rect5{-webkit-animation-delay:-0.8s;animation-delay:-0.8s}@-webkit-keyframes wf-stretchdelay{0%,40%,100%{-webkit-transform:scaleY(.4)}20%{-webkit-transform:scaleY(1)}}@keyframes wf-stretchdelay{0%,40%,100%{transform:scaleY(.4);-webkit-transform:scaleY(.4)}20%{transform:scaleY(1);-webkit-transform:scaleY(1)}}.widgetfly .wf-panel,.widgetfly.wf-panel{width:100% !important;border:none !important;overflow:hidden !important}.widgetfly .wf-animated-modal,.widgetfly.wf-animated-modal{-webkit-animation-duration:0.2s;animation-duration:0.2s;-webkit-animation-fill-mode:both;animation-fill-mode:both}@-webkit-keyframes wf-fadeInUpBig{0%{opacity:0;-webkit-transform:translate3d(0, 2000px, 0);transform:translate3d(0, 2000px, 0)}100%{opacity:1;-webkit-transform:none;transform:none}}@keyframes wf-fadeInUpBig{0%{opacity:0;-webkit-transform:translate3d(0, 2000px, 0);-ms-transform:translate3d(0, 2000px, 0);transform:translate3d(0, 2000px, 0)}100%{opacity:1;-webkit-transform:none;-ms-transform:none;transform:none}}.widgetfly .wf-animated-fadeInUpBig{-webkit-animation-name:wf-fadeInUpBig;animation-name:wf-fadeInUpBig}.widgetfly .wf-modal,.widgetfly.wf-modal{position:fixed;height:100%;top:0;right:0;bottom:0;left:0;z-index:1050;overflow:hidden;-webkit-overflow-scrolling:touch;outline:0;opacity:1}.widgetfly .wf-modal .wf-modal-dialog,.widgetfly.wf-modal .wf-modal-dialog{-webkit-transform:translate3d(0, 0, 0);-o-transform:translate3d(0, 0, 0);transform:translate3d(0, 0, 0);position:relative;margin:30px auto;min-width:240px}.widgetfly .wf-modal .wf-modal-dialog .wf-modal-content,.widgetfly.wf-modal .wf-modal-dialog .wf-modal-content{position:relative;background-color:#fff;border:1px solid #ccc;border:1px solid rgba(0,0,0,0.26);border-radius:3px;-webkit-box-shadow:0 2px 5px rgba(0,0,0,0.26);box-shadow:0 2px 5px rgba(0,0,0,0.26);background-clip:padding-box;outline:0;height:100%;overflow:hidden}.widgetfly .wf-modal .wf-modal-dialog .wf-modal-content .wf-modal-body,.widgetfly.wf-modal .wf-modal-dialog .wf-modal-content .wf-modal-body{position:relative;height:100%}.widgetfly .wf-modal .wf-modal-dialog .wf-modal-content .wf-close,.widgetfly.wf-modal .wf-modal-dialog .wf-modal-content .wf-close{position:absolute;right:0px;margin-top:-2px;margin-right:4px;text-decoration:none;font-size:21px;font-weight:600;line-height:1em;color:#000;text-shadow:0 1px 0 #fff;cursor:pointer;filter:alpha(opacity=50);opacity:.5;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;z-index:1050}.widgetfly .wf-modal.wf-modal-lg .wf-modal-dialog,.widgetfly.wf-modal.wf-modal-lg .wf-modal-dialog{max-width:80%;height:80%}.widgetfly .wf-modal.wf-modal-md .wf-modal-dialog,.widgetfly.wf-modal.wf-modal-md .wf-modal-dialog{max-width:50%;height:60%}.widgetfly .wf-modal.wf-modal-sm .wf-modal-dialog,.widgetfly.wf-modal.wf-modal-sm .wf-modal-dialog{max-width:30%;height:30%}.widgetfly .wf-modal-backdrop,.widgetfly.wf-modal-backdrop{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1040;background-color:#000;filter:alpha(opacity=50);opacity:.5}@media screen and (max-width:640px){.widgetfly.wf-modal .wf-modal-dialog,.widgetfly.wf-modal-lg .wf-modal-dialog,.widgetfly.wf-modal-md .wf-modal-dialog,.widgetfly.wf-modal-sm .wf-modal-dialog{width:100%;min-width:100%;height:100%;min-height:100%;padding:0;margin:0}.widgetfly.wf-modal .wf-modal-dialog .wf-modal-content,.widgetfly.wf-modal-lg .wf-modal-dialog .wf-modal-content,.widgetfly.wf-modal-md .wf-modal-dialog .wf-modal-content,.widgetfly.wf-modal-sm .wf-modal-dialog .wf-modal-content{position:fixed;top:0px;width:100%;min-width:100%;height:100%;min-height:100%;-webkit-animation-name:none;animation-name:none;border:0;border-radius:0}.widgetfly.wf-modal .wf-modal-dialog .wf-modal-content .wf-close,.widgetfly.wf-modal-lg .wf-modal-dialog .wf-modal-content .wf-close,.widgetfly.wf-modal-md .wf-modal-dialog .wf-modal-content .wf-close,.widgetfly.wf-modal-sm .wf-modal-dialog .wf-modal-content .wf-close{right:0px;margin-top:10px;margin-right:10px;font-size:28px;font-weight:800;border-radius:50%;width:35px;height:35px;text-align:center;line-height:23px;border:5px solid #000;text-shadow:none}}.widgetfly .wf-animated-popover,.widgetfly.wf-animated-popover{-webkit-animation-duration:0.5s;animation-duration:0.5s;-webkit-animation-fill-mode:both;animation-fill-mode:both}@-webkit-keyframes wf-fadeIn{0%{opacity:0}100%{opacity:1}}@keyframes wf-fadeIn{0%{opacity:0}100%{opacity:1}}.widgetfly .wf-animated-fadeIn,.widgetfly.wf-animated-fadeIn{-webkit-animation-name:wf-fadeIn;animation-name:wf-fadeIn}.widgetfly .wf-popover,.widgetfly.wf-popover{top:0;left:0;z-index:1010;padding:1px;text-align:left;background-color:#fff;background-clip:padding-box;border:1px solid #ccc;border:1px solid rgba(0,0,0,0.26);border-radius:3px;-webkit-box-shadow:0 2px 5px rgba(0,0,0,0.26);box-shadow:0 2px 5px rgba(0,0,0,0.26);white-space:normal;position:absolute;display:block;float:left;min-width:240px;width:280px}.widgetfly .wf-popover .wf-arrow,.widgetfly.wf-popover .wf-arrow{border-width:11px}.widgetfly .wf-popover .wf-arrow,.widgetfly.wf-popover .wf-arrow,.widgetfly .wf-popover .wf-arrow:after,.widgetfly.wf-popover .wf-arrow:after{position:absolute;display:block;width:0;height:0;border-color:transparent;border-style:solid;content:"";border-width:10px}.widgetfly .wf-popover.wf-top,.widgetfly.wf-popover.wf-top{margin-bottom:10px}.widgetfly .wf-popover.wf-top .wf-arrow,.widgetfly.wf-popover.wf-top .wf-arrow{bottom:-11px;left:50%;margin-left:-11px;border-top-color:#999;border-top-color:rgba(0,0,0,0.25);border-bottom-width:0}.widgetfly .wf-popover.wf-top .wf-arrow:after,.widgetfly.wf-popover.wf-top .wf-arrow:after{bottom:1px;margin-left:-10px;content:" ";border-top-color:#fff;border-bottom-width:0}.widgetfly .wf-popover.wf-left,.widgetfly.wf-popover.wf-left{margin-right:10px}.widgetfly .wf-popover.wf-left .wf-arrow,.widgetfly.wf-popover.wf-left .wf-arrow{top:50%;right:-11px;margin-top:-11px;border-right-width:0;border-left-color:#999;border-left-color:rgba(0,0,0,0.25)}.widgetfly .wf-popover.wf-left .wf-arrow:after,.widgetfly.wf-popover.wf-left .wf-arrow:after{right:1px;bottom:-10px;content:" ";border-right-width:0;border-left-color:#fff}.widgetfly .wf-popover.wf-bottom,.widgetfly.wf-popover.wf-bottom{margin-top:10px}.widgetfly .wf-popover.wf-bottom .wf-arrow,.widgetfly.wf-popover.wf-bottom .wf-arrow{top:-11px;left:50%;margin-left:-11px;border-top-width:0;border-bottom-color:#999;border-bottom-color:rgba(0,0,0,0.25)}.widgetfly .wf-popover.wf-bottom .wf-arrow:after,.widgetfly.wf-popover.wf-bottom .wf-arrow:after{top:1px;margin-left:-10px;content:" ";border-top-width:0;border-bottom-color:#fff}.widgetfly .wf-popover.wf-right,.widgetfly.wf-popover.wf-right{margin-left:10px}.widgetfly .wf-popover.wf-right .wf-arrow,.widgetfly.wf-popover.wf-right .wf-arrow{top:50%;left:-11px;margin-top:-11px;border-right-color:#999;border-right-color:rgba(0,0,0,0.25);border-left-width:0}.widgetfly .wf-popover.wf-right .wf-arrow:after,.widgetfly.wf-popover.wf-right .wf-arrow:after{bottom:-10px;left:1px;content:" ";border-right-color:#fff;border-left-width:0}',styleEl=document.createElement("style");if(document.getElementsByTagName("head")[0].appendChild(styleEl),styleEl.styleSheet)styleEl.styleSheet.disabled||(styleEl.styleSheet.cssText=cssText);else try{styleEl.innerHTML=cssText}catch(e){styleEl.innerText=cssText}}(),Widgetfly.Utils=function(){var idCounter=0,Utils={has:function(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)},each:function(obj,iterator,context){var i,l,key;if(null===obj)return!1;if(Array.prototype.forEach&&obj.forEach===Array.prototype.forEach)obj.forEach(iterator,context);else if("number"==typeof obj.length){for(i=0,l=obj.length;l>i;i++)if(iterator.call(context,obj[i],i,obj)==={})return!1}else for(key in obj)if(Widgetfly.Utils.has(obj,key)&&iterator.call(context,obj[key],key,obj)==={})return!1},isEmpty:function(obj){if(null===obj)return!0;if(obj.length>0)return!1;if(0===obj.length)return!0;for(var key in obj)if(hasOwnProperty.call(obj,key))return!1;return!0},extend:function(obj){return this.each(Array.prototype.slice.call(arguments,1),function(source){if(source)for(var prop in source)obj[prop]=source[prop]}),obj},inherit:function(Child,Parent){var F=function(){};F.prototype=Parent.prototype,Child.prototype=new F,Child.prototype.constructor=Child,Child.uber=Parent.prototype},params:function(str){return"string"!=typeof str?{}:(str=str.trim().replace(/^(\?|#)/,""),str?str.trim().split("&").reduce(function(ret,param){var parts=param.replace(/\+/g," ").split("="),key=parts[0],val=parts[1];return key=decodeURIComponent(key),val=void 0===val?null:decodeURIComponent(val),ret.hasOwnProperty(key)?Array.isArray(ret[key])?ret[key].push(val):ret[key]=[ret[key],val]:ret[key]=val,ret},{}):{})},uniqueId:function(prefix){var id=String(++idCounter);return prefix?prefix+id:id},isTrue:function(value){return value===!0||"true"===value?!0:!1},inIframe:function(){try{return window.self!==window.top}catch(e){return!0}},isFunction:function(obj){return"function"==typeof obj},isElement:function(o){return"object"==typeof HTMLElement?o instanceof HTMLElement:o&&"object"==typeof o&&null!==o&&1===o.nodeType&&"string"==typeof o.nodeName},hasClass:function(element,cls){return(" "+element.className+" ").indexOf(" "+cls+" ")>-1},addClass:function(element,className){var a,ad=className.split(" ");for(a in ad)this.hasClass(element,ad[a])||(element.className+=" "+ad[a]);this.innerStyle(element)},removeClass:function(element,rmClass){var newClass,r,rm=rmClass.split(" ");if(void 0!==element&&this.isElement(element)){newClass=" "+element.className.replace(/[\t\r\n]/g," ")+" ";for(r in rm)if(this.hasClass(element,rm[r])){for(;newClass.indexOf(" "+rm[r]+" ")>=0;)newClass=newClass.replace(" "+rm[r]+" "," ");element.className=newClass.replace(/^\s+|\s+$/g,"")}}this.innerStyle(element)},toggleClass:function(element,className){var newClass;if(void 0!==element&&this.isElement(element))if(newClass=" "+element.className.replace(/[\t\r\n]/g," ")+" ",this.hasClass(element,className)){for(;newClass.indexOf(" "+className+" ")>=0;)newClass=newClass.replace(" "+className+" "," ");element.className=newClass.replace(/^\s+|\s+$/g,"")}else element.className+=" "+className;this.innerStyle(element)},innerStyle:function(a,options){var i,r,ra,mr,cs,match,ruleExp,result,rules,mediaRules,mediaText,styles=[],sheets=document.styleSheets,o=[],extStyles="";a.matches=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector;for(i in sheets)if(!sheets[i].href){rules=sheets[i].rules||sheets[i].cssRules;for(r in rules)if(4===rules[r].type||rules[r].parentRule){if(mediaText=rules[r].media?rules[r].media.mediaText:rules[r].parentRule.media.mediaText,window.matchMedia(mediaText).matches){mediaRules=rules[r].rules||rules[r].cssRules||rules[r].parentRule.rules||rules[r].parentRule.cssRules;for(mr in mediaRules)a.matches(mediaRules[mr].selectorText)&&(console.log(mediaRules[mr].cssText),o.push(mediaRules[mr].cssText))}}else a.matches(rules[r].selectorText)&&o.push(rules[r].cssText)}for(i in o)r=o[i],ra=r.split(" "),r&&"string"==typeof r&&ra[0].indexOf(".widgetfly")>-1&&(ruleExp=/\{\s*([^\}]+)\s\}/g,match=ruleExp.exec(r),match&&(cs=r.split(" ")[1],0===cs.indexOf(".wf-")&&0!==cs.indexOf(".wf-animated-")&&styles.push(match[1])));if(result=styles.join(" "),options){for(i in options)extStyles+=options[i];a.setAttribute("data-ext-style",extStyles),result=result+" "+extStyles}else a.getAttribute("data-ext-style")&&(result=result+" "+a.getAttribute("data-ext-style"));a.style.cssText=result},actual:function(el){var elWidth,elHeight,style,fixStyle=" visibility: hidden !important; display: block !important; position: absolute !important;",size=function(s){return Boolean(s)?parseInt(s.substring(0,s.indexOf("px")),10):0};return style=el.getAttribute("style"),el.setAttribute("style",(style?style:"")+fixStyle),elWidth=el.offsetWidth,elHeight=el.offsetHeight,el.setAttribute("style",style?style:""),{width:elWidth+size(el.style.marginLeft)+size(el.style.marginRight),height:elHeight+size(el.style.marginTop)+size(el.style.marginBottom)}},offset:function(el){var docElem,win,elem=el,box={top:0,left:0},doc=elem&&elem.ownerDocument;if(doc)return docElem=doc.documentElement,void 0!==typeof elem.getBoundingClientRect&&(box=elem.getBoundingClientRect()),win=window,{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}},toElement:function(content){var el=document.createElement("div");return el.innerHTML=content,el.firstChild},throttle:function(method,scope){clearTimeout(scope._tId),scope._tId=setTimeout(function(){method.call(scope)},100)}};return Utils}(this),Widgetfly.Events=function(){var Events=function(){};return Events.prototype.trigger=function(action,data){Widgetfly.Mediator.send(this.id,action,data)},Events.prototype.on=function(action,callback){Widgetfly.Mediator.bind(this.id,action,callback)},Events.prototype.off=function(action){Widgetfly.Mediator.unbind(this.id,action)},Events}(this),Widgetfly.Mediator=function(){var Mediator={widgets:{},actionHandlers:{},init:function(){var self=this;window.addEventListener("message",function(msgObj){self.receive(msgObj)},!1)},getWidget:function(id){return this.widgets[id]},getActionHandlers:function(id){return this.actionHandlers[id]},register:function(id,widget){this.widgets[widget.id]=widget,widget.mediator=this,this.actionHandlers[widget.id]={}},unregister:function(id,callback){if(void 0!==this.actionHandlers[id]){var self=this;Widgetfly.Utils.each(this.actionHandlers[id],function(key){delete self.actionHandlers[id][key]})}delete this.widgets[id],callback&&callback(!0)},send:function(id,action,data){var parser,targetOrigin,corsObj={msg:data,action:action,id:id},widget=this.widgets[id];widget&&(parser=window.document.createElement("a"),parser.href=widget.iframe.src,targetOrigin=parser.protocol+"//"+parser.hostname+(parser.port&&80!==parseInt(parser.port,10)?":"+parser.port:""),widget.iframe.contentWindow.postMessage(corsObj,targetOrigin))},bind:function(id,action,callback){void 0===this.actionHandlers[id]&&(this.actionHandlers[id]={}),this.actionHandlers[id][action]=callback},unbind:function(id,action){delete this.actionHandlers[id][action],Object.keys(this.actionHandlers[id]).length<=0&&delete this.actionHandlers[id]},receive:function(msgObj){var origin,parser,widgetId=msgObj.data.id,widget=this.widgets[widgetId],myActionHandlers=this.actionHandlers[widgetId],action=msgObj.data.action;if(widget){if(parser=window.document.createElement("a"),parser.href=widget.iframe.src,origin=parser.protocol+"//"+parser.hostname+(parser.port&&80!==parseInt(parser.port,10)?":"+parser.port:""),origin!==msgObj.origin)return;widget&&Widgetfly.Utils.isFunction(widget[action])?widget[action](msgObj.data.msg):!Widgetfly.Utils.isEmpty(myActionHandlers)&&Widgetfly.Utils.isFunction(myActionHandlers[action])&&myActionHandlers[action](msgObj.data.msg)}}};return Mediator}(this),Widgetfly.Server=function(){var Server=function(){this.id=window.name,this.events={},this.init()};return Widgetfly.Utils.inherit(Server,Widgetfly.Events),Server.prototype.init=function(){var self=this,paramData=decodeURIComponent(window.location.hash.substring(1));this.options=JSON.parse(paramData),this.trigger("start"),window.addEventListener("message",function(msgObj){if(window.parent){var action,origin,parser;if(parser=window.document.createElement("a"),parser.href=self.options.origin,origin=parser.protocol+"//"+parser.hostname+(parser.port&&80!==parseInt(parser.port,10)?":"+parser.port:""),"file://"!==origin&&origin!==msgObj.origin)return;action=msgObj.data.action,Widgetfly.Utils.isFunction(self[action])?self[action](msgObj.data.msg):!Widgetfly.Utils.isEmpty(self.events)&&Widgetfly.Utils.isFunction(self.events[action])&&self.events[action](msgObj.data.msg)}},!1),this.options.autoGrow&&this.expand()},Server.prototype.on=function(key,callback){this.events[key]=callback},Server.prototype.off=function(key){delete this.events[key]},Server.prototype.trigger=function(action,data){var corsObj={msg:data,action:action,id:this.id};parent.postMessage(corsObj,this.options.origin)},Server.prototype.isShow=function(callback){var self=this,wrapper=function(data){self.off("_isShow",wrapper),callback(data)};this.on("_isShow",wrapper),this.trigger("isShow")},Server.prototype.onShow=function(callback){this.on("_onShow",callback)},Server.prototype.show=function(){this.trigger("show")},Server.prototype.hide=function(){this.trigger("hide")},Server.prototype.toggle=function(){this.trigger("toggle")},Server.prototype.close=function(){var self=this;Widgetfly.Utils.each(this.events,function(key){delete self.events[key]}),this.trigger("close")},Server.prototype.expand=function(){var self=this,compact=function(){if("complete"===document.readyState){var body=document.body,html=document.documentElement,height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);self.trigger("sizeChange",{height:height})}else compact._id=setTimeout(compact,100)};compact()},Server.prototype.compact=function(){var self=this,resize=function(){window.removeEventListener("resize",resize,!1);var body=document.body,html=document.documentElement,height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);self.trigger("sizeChange",{height:height})},compact=function(){"complete"===document.readyState?(window.addEventListener("resize",resize,!1),self.trigger("sizeChange",{height:0})):compact._id=setTimeout(compact,100)};compact()},Server}(this),Widgetfly.Widget=function(){var Widget=function(){return this.id=Widgetfly.Utils.uniqueId("widget"),this};return Widget.DEFAULTS=Widgetfly.Utils.extend({},{spinner:'<div class="widgetfly wf-spinner"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>'}),Widgetfly.Utils.inherit(Widget,Widgetfly.Events),Widget.prototype.getId=function(){return this.id},Widget.prototype.style=function(){var r=function(el){el.className&&Widgetfly.Utils.addClass(el,el.className);var i,j,nodes=el.childNodes;for(i in nodes)if(!nodes[i].className||0!==nodes[i].className.indexOf("widgetfly")&&0!==nodes[i].className.indexOf("wf-")||Widgetfly.Utils.addClass(nodes[i],nodes[i].className),nodes[i].childNodes)for(j in nodes[i].childNodes)r(nodes[i].childNodes[j])};r(this.el)},Widget.prototype.getIframe=function(){var iframe=this.el.querySelector("iframe");return iframe||"IFRAME"===this.el.tagName&&(iframe=this.el),iframe},Widget.prototype.onStart=function(callback){Widgetfly.Utils.isFunction(callback)&&this.on("onStart",callback)},Widget.prototype.start=function(){var handlers=Widgetfly.Mediator.getActionHandlers(this.id);handlers&&Widgetfly.Utils.isFunction(handlers.onStart)&&handlers.onStart(),Widgetfly.Utils.isTrue(this.options.show)?this.show():this.hide()},Widget.prototype.onHide=function(callback){Widgetfly.Utils.isFunction(callback)&&this.on("onHide",callback)},Widget.prototype.hide=function(){Widgetfly.Utils.removeClass(this.el,"wf-show wf-hide"),Widgetfly.Utils.addClass(this.el,"wf-hide");var handlers=Widgetfly.Mediator.getActionHandlers(this.id);handlers&&Widgetfly.Utils.isFunction(handlers.onHide)&&handlers.onHide()},Widget.prototype.toggle=function(){this.isShow()?this.hide():this.show()},Widget.prototype.onShow=function(callback){Widgetfly.Utils.isFunction(callback)&&this.on("onShow",callback)},Widget.prototype.isShow=function(){var result=Widgetfly.Utils.hasClass(this.el,"wf-show");return this.trigger("_isShow",result),result},Widget.prototype.show=function(){var handlers;Widgetfly.Utils.removeClass(this.el,"wf-show wf-hide"),Widgetfly.Utils.addClass(this.el,"wf-show"),handlers=Widgetfly.Mediator.getActionHandlers(this.id),handlers&&Widgetfly.Utils.isFunction(handlers.onShow)&&handlers.onShow(),this.trigger("_onShow")},Widget.prototype.onBeforeClose=function(callback){Widgetfly.Utils.isFunction(callback)&&this.on("onBeforeClose",callback)},Widget.prototype.close=function(){var r,handlers,self=this;handlers=Widgetfly.Mediator.getActionHandlers(this.id),handlers&&Widgetfly.Utils.isFunction(handlers.onBeforeClose)&&(r=handlers.onBeforeClose()),r!==!1&&(this.trigger("_onClose"),Widgetfly.Mediator.unregister(this.id,function(){self.container.removeChild(self.el)}))},Widget.prototype.register=function(){var nowScripts=document.currentScript;Widgetfly.Mediator.register(this.id,this),nowScripts&&nowScripts.setAttribute("data-id",this.id)},Widget.prototype.render=function(){var src,iframe,origin,urlOptions,self=this;return origin="file:"===window.location.protocol?window.location.protocol+"//"+window.location.pathname:window.location.protocol+"//"+window.location.hostname+(parseInt(window.location.port,10)&&80!==window.location.port?":"+window.location.port:""),urlOptions={origin:origin,options:this.options.options,autoGrow:this.options.autoGrow},this.spinner=Widgetfly.Utils.toElement(this.options.spinner),this.el=Widgetfly.Utils.toElement(this.options.template),iframe=this.getIframe(),iframe.setAttribute("name",this.id),src=-1===this.options.src.indexOf("#")?this.options.src+"#":this.options.src.substring(0,this.options.src.indexOf("#"))+"#",src+=encodeURIComponent(JSON.stringify(urlOptions)),iframe.onload=function(){self.spinner&&self.spinner.parentNode&&self.spinner.parentNode.removeChild(self.spinner)},iframe.setAttribute("src",src),iframe},Widget.prototype.sizeChange=function(size){this.isShow()&&Widgetfly.Utils.innerStyle(this.iframe,{size:"height:"+("string"==typeof size.height?size.height:String(size.height)+"px")})},Widget}(this),Widgetfly.Panel=function(){var Panel=function(options){if(Widgetfly.Widget.apply(this,arguments),this.options=Widgetfly.Utils.extend({},Panel.DEFAULTS,options),void 0===options||void 0===options.container||null===options.container)return!1;if("string"==typeof options.container?this.container=document.querySelector(options.container):"object"==typeof options.container&&(this.container=options.container),this.container&&this.container.length<=0)return!1;if(this.register(this.id),this.render(),this.iframe=this.getIframe(),this.style(),this.container){for(var n in this.container.childNodes)"SCRIPT"!==this.container.childNodes[n].nodeName&&this.container.childNodes[n].parentNode===this.container&&this.container.removeChild(this.container.childNodes[n]);this.container.appendChild(this.spinner),this.container.appendChild(this.el)}return this};return Panel.DEFAULTS=Widgetfly.Utils.extend({},Widgetfly.Widget.DEFAULTS,{autoGrow:!1,show:!0,template:'<iframe allowtransparency="true" frameborder="0" tabindex="0" title="Widgetfly Widget" width="100%" class="widgetfly wf-panel wf-hide"></iframe>',options:{}}),Widgetfly.Utils.inherit(Panel,Widgetfly.Widget),Panel.prototype.close=function(){var r,handlers,self=this;handlers=Widgetfly.Mediator.getActionHandlers(this.id),handlers&&Widgetfly.Utils.isFunction(handlers.onBeforeClose)&&(r=handlers.onBeforeClose()),r!==!1&&Widgetfly.Mediator.unregister(this.id,function(){self.container.remove(0)})},Panel}(this),Widgetfly.Modal=function(){var Modal=function(options){var sizeClass,aw,w,self=this;if(Widgetfly.Widget.apply(this,arguments),this.options=Widgetfly.Utils.extend({},Modal.DEFAULTS,options),this.container=window.document.querySelector("body"),void 0===options)return!1;aw=Widgetfly.Mediator.widgets;for(w in aw)aw[w]instanceof Widgetfly.Modal&&aw[w].close();return this.register(this.id),this.container&&(this.render(),this.iframe=this.getIframe(),this.backdrop=document.createElement("div"),sizeClass="large"===this.options.size?"wf-modal-lg":"small"===this.options.size?"wf-modal-sm":"wf-modal-md",Widgetfly.Utils.addClass(this.el,sizeClass),Widgetfly.Utils.addClass(this.backdrop,"widgetfly wf-modal-backdrop wf-hide"),this.el.querySelector(".wf-close").onclick=function(){self.hide()},this.el.onclick=function(e){e.target===self.el&&self.hide()},this.options.backdrop&&this.container.appendChild(this.backdrop),this.style(),this.el.querySelector(".wf-modal-content").insertBefore(this.spinner,this.iframe),this.container.appendChild(this.el)),this.resizeCallback=function(){self.isShow()&&Widgetfly.Utils.throttle(self.style,self)},window.addEventListener("resize",this.resizeCallback,!1),this};return Modal.DEFAULTS=Widgetfly.Utils.extend({},Widgetfly.Widget.DEFAULTS,{autoGrow:!1,show:!0,backdrop:!0,template:'<div class="widgetfly wf-modal wf-hide"><div class="wf-modal-dialog"><div class="wf-modal-content wf-animated-fadeInUpBig wf-animated-modal"><a class="wf-close" href="javascript:void(0)">&#215</a><iframe allowtransparency="true" frameborder="0" tabindex="0" title="Widgetfly Widget" width="100%" class="wf-modal-body wf-show"></iframe></div></div></div>',options:{}}),Widgetfly.Utils.inherit(Modal,Widgetfly.Widget),Modal.prototype.show=function(){for(var i in this.mediator.widgets)this.mediator.widgets[i]instanceof Widgetfly.Modal&&this.mediator.widgets[i].isShow()&&this.mediator.widgets[i].hide();this.style(),Widgetfly.Widget.prototype.show.apply(this,arguments),Widgetfly.Utils.isTrue(this.options.backdrop)&&(Widgetfly.Utils.removeClass(this.backdrop,"wf-show wf-hide"),Widgetfly.Utils.addClass(this.backdrop,"wf-show"))},Modal.prototype.hide=function(){Widgetfly.Widget.prototype.hide.apply(this,arguments),Widgetfly.Utils.isTrue(this.options.backdrop)&&(Widgetfly.Utils.removeClass(this.backdrop,"wf-show wf-hide"),Widgetfly.Utils.addClass(this.backdrop,"wf-hide"))},Modal.prototype.close=function(){var r,handlers,self=this;handlers=Widgetfly.Mediator.getActionHandlers(this.id),handlers&&Widgetfly.Utils.isFunction(handlers.onBeforeClose)&&(r=handlers.onBeforeClose()),window.removeEventListener("resize",this.resizeCallback,!1),r!==!1&&Widgetfly.Mediator.unregister(this.id,function(){self.container.removeChild(self.el),Widgetfly.Utils.isTrue(self.options.backdrop)&&self.container.removeChild(self.backdrop)})},Modal.prototype.sizeChange=function(size){this.isShow()&&(Widgetfly.Utils.innerStyle(this.el.querySelector(".wf-modal-dialog"),{size:"height:"+("string"==typeof size.height?size.height:String(size.height)+"px")}),Widgetfly.Widget.prototype.sizeChange.apply(this,arguments))},Modal}(this),Widgetfly.Popover=function(){var Popover=function(options){var self=this;return Widgetfly.Widget.apply(this,arguments),this.options=Widgetfly.Utils.extend({},Popover.DEFAULTS,options),this.styles={},options.styles&&(this.styles.extra=options.styles),this.container=window.document.querySelector("body"),void 0===options||void 0===options.target||null===options.target?!1:(this.register(this.id),"string"==typeof options.target?this.target=document.querySelector(options.target):"object"==typeof options.target&&(this.target=options.target),this.target&&this.target.length<=0?!1:(this.render(),this.options.size&&(this.styles.size="height:"+this.options.size.height+"; width:"+this.options.size.width),this.iframe=this.getIframe(),this.style(),this.container&&(this.el.insertBefore(this.spinner,this.iframe),this.container.appendChild(this.el)),this.resizeCallback=function(){self.isShow()&&Widgetfly.Utils.throttle(self.style,self)},window.addEventListener("resize",this.resizeCallback,!1),this))};return Popover.DEFAULTS=Widgetfly.Utils.extend({},Widgetfly.Widget.DEFAULTS,{autoGrow:!1,show:!0,placement:"right",template:'<div class="widgetfly wf-popover wf-hide wf-animated-fadeIn wf-animated-popover"><div class="wf-arrow"></div><iframe allowtransparency="true" frameborder="0" tabindex="0" title="Widgetfly Widget" width="100%" class="wf-popover-content"></iframe></div>',options:{}}),Widgetfly.Utils.inherit(Popover,Widgetfly.Widget),Popover.prototype.style=function(){var vw,vh,vert,vertPlacement,horiz,horizPlacement,size=Widgetfly.Utils.actual(this.el);this.placement=this.options.placement,"auto"!==this.options.placement&&Boolean(this.options.placement)||(vw=Math.max(document.documentElement.clientWidth,window.innerWidth||0),vh=Math.max(document.documentElement.clientHeight,window.innerHeight||0),vert=.5*vh-size.width,vertPlacement=vert>0?"bottom":"top",horiz=.5*vw-size.height,horizPlacement=horiz>0?"right":"left",this.placement=Math.abs(horiz)>Math.abs(vert)?horizPlacement:vertPlacement),window.innerWidth<=640&&"left"===this.options.placement?this.placement="top":window.innerWidth<=640&&"right"===this.options.placement&&(this.placement="bottom"),Widgetfly.Utils.removeClass(this.el,"wf-top wf-right wf-bottom wf-left"),Widgetfly.Utils.addClass(this.el,"wf-"+this.placement),Widgetfly.Widget.prototype.style.apply(this,arguments),this.applyPlacement()},Popover.prototype.applyPlacement=function(){Widgetfly.Utils.innerStyle(this.el,this.styles);var top,left,arrowOffset,offset=Widgetfly.Utils.offset(this.target),tg=Widgetfly.Utils.actual(this.target),el=Widgetfly.Utils.actual(this.el);"left"===this.placement?(top=offset.top+Math.round(tg.height/2)-Math.round(el.height/2),left=offset.left-el.width):"top"===this.placement?(top=offset.top-el.height,left=offset.left+Math.round(tg.width/2)-Math.round(el.width/2),0>left?(arrowOffset=Math.round(tg.width/2)+offset.left,left=5):left+el.width>window.innerWidth&&(left=window.innerWidth-el.width-5,arrowOffset=offset.left-left+Math.round(tg.width/2))):"bottom"===this.placement?(top=offset.top+tg.height,left=offset.left+Math.round(tg.width/2)-Math.round(el.width/2),0>left?(arrowOffset=Math.round(tg.width/2)+offset.left,left=5):left+el.width>window.innerWidth&&(left=window.innerWidth-el.width-5,arrowOffset=offset.left-left+Math.round(tg.width/2))):(top=offset.top+Math.round(tg.height/2)-Math.round(el.height/2),left=offset.left+tg.width),this.styles.offset="top: "+("string"==typeof top?top:String(top)+"px")+"; left:"+("string"==typeof left?left:String(left)+"px;"),Widgetfly.Utils.innerStyle(this.el,this.styles),arrowOffset?Widgetfly.Utils.innerStyle(this.el.querySelector(".wf-arrow"),{offset:"left:"+("string"==typeof arrowOffset?arrowOffset:String(arrowOffset)+"px;")}):Widgetfly.Utils.innerStyle(this.el.querySelector(".wf-arrow"),{offset:""})},Popover.prototype.show=function(){this.style(),Widgetfly.Widget.prototype.show.apply(this,arguments)},Popover.prototype.close=function(){window.window.removeEventListener("resize",this.resizeCallback,!1),Widgetfly.Widget.prototype.close.apply(this,arguments)},Popover}(this),function(){var nowScripts,params,parser,extend=function(protoProps,staticProps){var child,Surrogate,parent=this;return child=protoProps&&Widgetfly.Utils.has(protoProps,"constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},Widgetfly.Utils.extend(child,parent,staticProps),Surrogate=function(){this.constructor=child
},Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,protoProps&&Widgetfly.Utils.extend(child.prototype,protoProps),child.__super__=parent.prototype,child};Widgetfly.Panel.extend=Widgetfly.Modal.extend=Widgetfly.Popover.extend=Widgetfly.Server.extend=extend,Widgetfly.init=function(){Widgetfly.Utils.inIframe()?(Widgetfly.Server._default=new Widgetfly.Server({}),Widgetfly.Server.get=function(){return Widgetfly.Server._default}):(Widgetfly.Mediator.init(),nowScripts=document.currentScript,nowScripts&&(parser=document.createElement("a"),parser.href=nowScripts.getAttribute("src"),params=Widgetfly.Utils.params(parser.hash),Widgetfly.Utils.isEmpty(params)||("modal"===params.type?(delete params.container,new(Widgetfly.Modal.extend({}))(params)):"popover"===params.type?(params.target||(params.target=nowScripts.parentNode),new(Widgetfly.Popover.extend({}))(params)):(params.container||(params.container=nowScripts.parentNode),new(Widgetfly.Panel.extend({}))(params)))),Widgetfly.Server.get=function(){throw"Widgetfly.Server is not supported outside iframe."})},Widgetfly.init()}(this)),Widgetfly}(window);return Widgetfly});
//# sourceMappingURL=widgetfly.min.js.map